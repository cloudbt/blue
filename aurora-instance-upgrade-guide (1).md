# Aurora MySQLインスタンスクラス変更ガイド

## 変更方法

### 1. リーダーインスタンスの変更:
- AWS Management ConsoleまたはAWS CLIを使用して、各リーダーインスタンスを個別に変更します。
- 変更中、短時間のダウンタイムが発生しますが、ライターインスタンスは影響を受けません。
- リーダーを1つずつ変更することで、常に少なくとも1つのリーダーが利用可能な状態を維持できます。

### 2. ライターインスタンスの変更:
- ライターインスタンスの変更には、フェイルオーバーが必要です。
- Aurora の自動フェイルオーバー機能を利用するか、手動でフェイルオーバーを実行します。
- フェイルオーバー中、短時間（通常60秒以内）の書き込み操作の中断が発生します。

## アプリケーションへの影響を最小限に抑えるためのヒント

1. メンテナンスウィンドウ中に実行: トラフィックの少ない時間帯を選んで変更を実施します。

2. アプリケーションの準備:
   - 接続プールを使用している場合、古い接続を適切に破棄し、新しい接続を確立するようにアプリケーションを設定します。
   - フェイルオーバーに対応できるよう、アプリケーションにリトライロジックを実装します。

3. 段階的な変更: リーダーを1つずつ変更し、各変更後にアプリケーションの動作を確認します。

## コストの比較

注意: 以下は概算であり、実際のコストは使用状況やその他の要因によって異なる場合があります。

### インスタンススペック比較

**db.r5.large (現在):**
- vCPU: 2
- メモリ: 16 GiB
- ネットワークパフォーマンス: 最大10 Gbps

**db.r6g.large (変更後):**
- vCPU: 2
- メモリ: 16 GiB
- ネットワークパフォーマンス: 最大10 Gbps

一般的に、db.r6g.largeはdb.r5.largeと比較して約10-20%のコスト削減が期待できます。

### コスト概算例 (アジアパシフィック東京リージョン)

**オンデマンド料金:**
- db.r5.large: 約$0.334/時
- db.r6g.large: 約$0.2804/時

**3つのインスタンス合計:**
- 変更前: $0.334 x 24 x 30 x 3 = 約$721.44/月
- 変更後: $0.2804 x 24 x 30 x 3 = 約$605.66/月

この例では、月額約$115.78の削減が見込まれます。

注意: これはあくまで概算であり、実際のコストは様々な要因によって変動する可能性があります。正確なコストについては、AWS料金計算ツールを使用するか、AWSの担当者に相談することをお勧めします。
